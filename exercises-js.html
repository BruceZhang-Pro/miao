<script>
  "use strict"
function swap(array, x, y) {
  let temp = array[y]
  array[y] = array[x]
  array[x] = temp

  return temp
}
function judgeOrderBy(array, myMap = it => it) {
  for (let i = 1; i < array.length; i++) {
    if (myMap(array[i - 1]) > myMap(array[i])) {
      return false
    }
  }
  console.log(array)
  return true
}
function myRandomArray(length, size = length) {
  let array = []
  for (let i = 0; i < length; i ++) {
    if (i % 2 == 0) {
      array.push(-(Math.random() * size | 0))
    } else {
      array.push(Math.random() * size | 0)
    }
  }
  // console.log(array)
  return array
}
</script>
<!-- <script src="oop.js"></script> -->

<script src="lodash/brucezhang_pro-lodash.js"></script>

<script type="1" id="ch02/01">
  // 书本第二章课后习题第1题
  var height = +prompt('请输入行数')
  var symbol = prompt('请输入字符')
  var result = ''
  var currentSymbol = symbol

  for (var i = 0; i < height; i++) {
    if (i + 1 == height) {
      result += currentSymbol
    } else {
      result += currentSymbol + '\n'
    }
    currentSymbol += symbol
  }
  console.log(result)
</script>

<script type="1" id="ch02/02">
  // 书本第二章课后习题第2题
  var number = +prompt('请输入一个正整数')

  for (var i = 1; i <= number; i++) {
    if (i % 3 == 0 && i % 5 == 0) {
      console.log('FizzBuzz')
    } else if (i % 3 == 0) {
      console.log('Fizz')
    } else if (i % 5 == 0) {
      console.log('Buzz')
    } else {
      console.log(i)
    }
  }
</script>

<script type="1" id="ch02/03">
  // 书本第二章课后习题第3题
  var height = +prompt('请输入行数')
  var width = +prompt('请输入列数')
  var result = ''

  for (var i = 1; i <= height; i++) {
    for (var j = 1; j <= width; j++) {
      if ((i + j) % 2 == 0) {
        result += ' '
      } else {
        result += '#'
      }
    }
    result += '\n'
  }
  console.log(result)
</script>

<script type="1" id="ch03/03">
    // 书本第三章课后习题第3题
  let charactor = prompt('请输入一堆字母')
  let char = prompt('请输入要计数的字母')
  function countBs(charactor) {
    let count = 0
    for (var i = 0; i < charactor.length; i++) {
      if (charactor.charAt(i) === 'B') {
        count++
      }
    }
    return count
  }

  function countChar(charactor, char) {
    let count = 0
    for (var i = 0; i < charactor.length; i++) {
      if (charactor.charAt(i) === char) {
        count++
      }
    }
    return count
  }

  function countBs2(charactor) {
    return countChar(charactor, 'B')
  }

console.log(countBs2(charactor))

</script>

<script type="1" id="ch03/0001">
//课后作业
//上台阶台阶数固定,计算一共有几种方法(可以一次上两阶,可以一次上一台阶)
function setStartCount(number) {
  function stairClimbing (count = 0, method = '') {
    if (count == number) {
      console.log(method)
      return
    }
    if (count > number) {
      return
    }

    stairClimbing(count + 2, method + 2)
    stairClimbing(count + 1, method + 1)
  }
  stairClimbing()
}
</script>
<script type="1" id="ch03/0002">
//课后作业
//走网格,从左下角走到右上角一共有多少种方法(每次只能选择往右走与往上走)
let count = 0
function walkGrid (x, y, route = '') {

  if (x == 7 && y == 7) {
    console.log(route)
    count++
    return
  }
  if (x > 7) {
    count++
    return
  }
  if (y > 7) {
    count++
    return
  }
  walkGrid(x + 1, y, route + 'right')
  walkGrid(x, y + 1, route + 'top')

}
</script>

<script type="1" id="ch04/0000">
//第四章的松鼠人示例

var JOURNAL = [
  {"events":["carrot","exercise","weekend"],"squirrel":false},
  {"events":["bread","pudding","brushed teeth","weekend","touched tree"],"squirrel":false},
  {"events":["carrot","nachos","brushed teeth","cycling","weekend"],"squirrel":false},
  {"events":["brussel sprouts","ice cream","brushed teeth","computer","weekend"],"squirrel":false},
  {"events":["potatoes","candy","brushed teeth","exercise","weekend","dentist"],"squirrel":false},
  {"events":["brussel sprouts","pudding","brushed teeth","running","weekend"],"squirrel":false},
  {"events":["pizza","brushed teeth","computer","work","touched tree"],"squirrel":false},
  {"events":["bread","beer","brushed teeth","cycling","work"],"squirrel":false},
  {"events":["cauliflower","brushed teeth","work"],"squirrel":false},
  {"events":["pizza","brushed teeth","cycling","work"],"squirrel":false},
  {"events":["lasagna","nachos","brushed teeth","work"],"squirrel":false},
  {"events":["brushed teeth","weekend","touched tree"],"squirrel":false},
  {"events":["lettuce","brushed teeth","television","weekend"],"squirrel":false},
  {"events":["spaghetti","brushed teeth","work"],"squirrel":false},
  {"events":["brushed teeth","computer","work"],"squirrel":false},
  {"events":["lettuce","nachos","brushed teeth","work"],"squirrel":false},
  {"events":["carrot","brushed teeth","running","work"],"squirrel":false},
  {"events":["brushed teeth","work"],"squirrel":false},
  {"events":["cauliflower","reading","weekend"],"squirrel":false},
  {"events":["bread","brushed teeth","weekend"],"squirrel":false},
  {"events":["lasagna","brushed teeth","exercise","work"],"squirrel":false},
  {"events":["spaghetti","brushed teeth","reading","work"],"squirrel":false},
  {"events":["carrot","ice cream","brushed teeth","television","work"],"squirrel":false},
  {"events":["spaghetti","nachos","work"],"squirrel":false},
  {"events":["cauliflower","ice cream","brushed teeth","cycling","work"],"squirrel":false},
  {"events":["spaghetti","peanuts","computer","weekend"],"squirrel":true},
  {"events":["potatoes","ice cream","brushed teeth","computer","weekend"],"squirrel":false},
  {"events":["potatoes","ice cream","brushed teeth","work"],"squirrel":false},
  {"events":["peanuts","brushed teeth","running","work"],"squirrel":false},
  {"events":["potatoes","exercise","work"],"squirrel":false},
  {"events":["pizza","ice cream","computer","work"],"squirrel":false},
  {"events":["lasagna","ice cream","work"],"squirrel":false},
  {"events":["cauliflower","candy","reading","weekend"],"squirrel":false},
  {"events":["lasagna","nachos","brushed teeth","running","weekend"],"squirrel":false},
  {"events":["potatoes","brushed teeth","work"],"squirrel":false},
  {"events":["carrot","work"],"squirrel":false},
  {"events":["pizza","beer","work","dentist"],"squirrel":false},
  {"events":["lasagna","pudding","cycling","work"],"squirrel":false},
  {"events":["spaghetti","brushed teeth","reading","work"],"squirrel":false},
  {"events":["spaghetti","pudding","television","weekend"],"squirrel":false},
  {"events":["bread","brushed teeth","exercise","weekend"],"squirrel":false},
  {"events":["lasagna","peanuts","work"],"squirrel":true},
  {"events":["pizza","work"],"squirrel":false},
  {"events":["potatoes","exercise","work"],"squirrel":false},
  {"events":["brushed teeth","exercise","work"],"squirrel":false},
  {"events":["spaghetti","brushed teeth","television","work"],"squirrel":false},
  {"events":["pizza","cycling","weekend"],"squirrel":false},
  {"events":["carrot","brushed teeth","weekend"],"squirrel":false},
  {"events":["carrot","beer","brushed teeth","work"],"squirrel":false},
  {"events":["pizza","peanuts","candy","work"],"squirrel":true},
  {"events":["carrot","peanuts","brushed teeth","reading","work"],"squirrel":false},
  {"events":["potatoes","peanuts","brushed teeth","work"],"squirrel":false},
  {"events":["carrot","nachos","brushed teeth","exercise","work"],"squirrel":false},
  {"events":["pizza","peanuts","brushed teeth","television","weekend"],"squirrel":false},
  {"events":["lasagna","brushed teeth","cycling","weekend"],"squirrel":false},
  {"events":["cauliflower","peanuts","brushed teeth","computer","work","touched tree"],"squirrel":false},
  {"events":["lettuce","brushed teeth","television","work"],"squirrel":false},
  {"events":["potatoes","brushed teeth","computer","work"],"squirrel":false},
  {"events":["bread","candy","work"],"squirrel":false},
  {"events":["potatoes","nachos","work"],"squirrel":false},
  {"events":["carrot","pudding","brushed teeth","weekend"],"squirrel":false},
  {"events":["carrot","brushed teeth","exercise","weekend","touched tree"],"squirrel":false},
  {"events":["brussel sprouts","running","work"],"squirrel":false},
  {"events":["brushed teeth","work"],"squirrel":false},
  {"events":["lettuce","brushed teeth","running","work"],"squirrel":false},
  {"events":["candy","brushed teeth","work"],"squirrel":false},
  {"events":["brussel sprouts","brushed teeth","computer","work"],"squirrel":false},
  {"events":["bread","brushed teeth","weekend"],"squirrel":false},
  {"events":["cauliflower","brushed teeth","weekend"],"squirrel":false},
  {"events":["spaghetti","candy","television","work","touched tree"],"squirrel":false},
  {"events":["carrot","pudding","brushed teeth","work"],"squirrel":false},
  {"events":["lettuce","brushed teeth","work"],"squirrel":false},
  {"events":["carrot","ice cream","brushed teeth","cycling","work"],"squirrel":false},
  {"events":["pizza","brushed teeth","work"],"squirrel":false},
  {"events":["spaghetti","peanuts","exercise","weekend"],"squirrel":true},
  {"events":["bread","beer","computer","weekend","touched tree"],"squirrel":false},
  {"events":["brushed teeth","running","work"],"squirrel":false},
  {"events":["lettuce","peanuts","brushed teeth","work","touched tree"],"squirrel":false},
  {"events":["lasagna","brushed teeth","television","work"],"squirrel":false},
  {"events":["cauliflower","brushed teeth","running","work"],"squirrel":false},
  {"events":["carrot","brushed teeth","running","work"],"squirrel":false},
  {"events":["carrot","reading","weekend"],"squirrel":false},
  {"events":["carrot","peanuts","reading","weekend"],"squirrel":true},
  {"events":["potatoes","brushed teeth","running","work"],"squirrel":false},
  {"events":["lasagna","ice cream","work","touched tree"],"squirrel":false},
  {"events":["cauliflower","peanuts","brushed teeth","cycling","work"],"squirrel":false},
  {"events":["pizza","brushed teeth","running","work"],"squirrel":false},
  {"events":["lettuce","brushed teeth","work"],"squirrel":false},
  {"events":["bread","brushed teeth","television","weekend"],"squirrel":false},
  {"events":["cauliflower","peanuts","brushed teeth","weekend"],"squirrel":false}
];

// This makes sure the data is exported in node.js —
// `require('./path/to/journal.js')` will get you the array.
if (typeof module != "undefined" && module.exports && (typeof window == "undefined" || window.exports != exports))
  module.exports = JOURNAL;
if (typeof global != "undefined" && !global.JOURNAL)
  global.JOURNAL = JOURNAL;

let hasEvent = function(event, entry) {
  return entry.events.includes(event)
}

let tableFor = function(event, journal) {
  let eventData = [0, 0, 0, 0]
  let entry = {}
  let index = 0
  for (let i = 0; i < journal.length; i++) {
    index = 0
    entry = journal[i]
    if (hasEvent(event, entry)) {
      index += 1
    }
    if (entry.squirrel) {
      index += 2
    }
    eventData[index] += 1
  }
  return eventData
}

let phi = function(data) {
  let result = 0

  result = (data[3] * data[0] - data[1] * data[2]) / 
  Math.sqrt((data[2] + data[3]) * (data[1] + data[0]) * (data[1] + data[3]) * (data[0] + data[2]))

  return result
}

let oneEventsCorrelations = function(event, journal) {
  let statisticArray = []
  let numCorrelations = 0
  statisticArray = tableFor(event, journal)
  numCorrelations = phi(statisticArray)

  return numCorrelations
}

function forEach(array, action) {
  for (let i = 0; i < array.length; i++) {
    action(array[i])
  }
}

let gatherCorrelations = function(JOURNAL) {
  let correlation = {}
  let events = []

  JOURNAL.forEach(entry => {
    entry.events.forEach(event => {
      if (event in correlation == false) {
        correlation[event] = oneEventsCorrelations(event, JOURNAL)
      }
    })
  })

  return correlation
}

// let gatherCorrelations = function(JOURNAL) {
//   let correlation = {}
//   let events = []

//   for (let entry = 0; entry < JOURNAL.length; entry++) {
//     events = JOURNAL[entry].events
//     for (let j = 0; j < events.length; j++) {
//       let event = events[j]
//       if (event in correlation == false) {
//         correlation[event] = oneEventsCorrelations(event, JOURNAL)
//       }
//     }
//   }

//   return correlation
// }

let printCorrelation = function() {
  let correlation = {}
  correlation = gatherCorrelations(JOURNAL)

  for (let key in correlation) {
    if (correlation[key] < -0.1 || correlation[key] > 0.1) {
      console.log(key + ': ' + correlation[key])
    }
  }
}

let setJournal = function() {
  let journal = JOURNAL
  let entry = {}
  for (let i = 0; i < journal.length; i ++) {
    entry = journal[i]
    if (entry.events.includes("peanuts") && !entry.events.includes("brushed teeth")) {
      entry.events.push("peanuts teeth")
    }
  }
}

printCorrelation()
setJournal()
console.log("peanuts teeth: " + oneEventsCorrelations("peanuts teeth", JOURNAL))

</script>
<script type="1" id="ch04/0001">
  //课上写的
  function index(array, index) {
    for(let i =0; i < array.length; i++) {
      if (array[i] == index) {
        return i
      }
    }
    return -1
  }

let slice =function(array, start = 0, end = array.length) {
  for (let i = 0; i < end; i++) {
    array1[i] = array[i]
  }
  return array1
}

function concat() {
  let array = []
  for (let i = 0; i < arguments.length; i++) {
    let arg = arguments[i]
    if(Array.isArray(arg)) {
      for (let j = 0; j < arg.length; j++) {
        array.push(arg[j])
      }
    } else {
      array.push(arg)
    }
  }
  return array
}
</script>

<script type="1" id="ch04/0002">
  // 深度对比两个变量是否相等
function judgement(dataA, dataB) {

  if (dataA == null || dataB == null) {
    return dataA === dataB
  } else if (Array.isArray(dataA) == true && Array.isArray(dataB) == true) {
    if (dataA.length == dataB.length) {
      for (let i = 0; i < dataA.length; i++) {
        if (judgement(dataA[i], dataB[i]) == false) {
          return false
        }
      }
      return true
    } else {
      return false
    }
  } else if (dataA.constructor === Object && dataB.constructor === Object) {
    let dataAKey = Object.keys(dataA)
    let dataBKey = Object.keys(dataB)
    if (dataAKey.length == dataBKey.length) {
      for (let i = 0; i < dataAKey.length; i++) {
        if (judgement(dataAKey[i], dataBKey[i]) == false) {
          return false
        }
      }
      for (let key in dataA) {
        if (judgement(dataA[key], dataB[key]) == false) {
            return false
        }
      }
      return true
    } else {
      return false
    }
  } else {
    return dataA === dataB
  }
}

  function isEqualMy(dataA, dataB) {
    return judgement(dataA, dataB)
  }
  
  var a = [1,2,3]
  var b = [1,2,3]
  console.log(isEqualMy(a, b))
  
  var a = [1,2,3,4]
  var b = [1,2,3]
  console.log(isEqualMy(a, b))
  
  var a = [1,2,3,4]
  var b = [1,2,3,5]
  console.log(isEqualMy(a, b))
  
  var a = [1,2,3,'asda']
  var b = 3
  console.log(isEqualMy(a, b))
  
  var a = null
  var b = null
  console.log(isEqualMy(a, b))
  
  var a = [1,2,3,4]
  var b = null
  console.log(isEqualMy(a, b))
  
  var a = [1,2,3,4]
  var b = undefined
  console.log(isEqualMy(a, b))
  
  var a = false
  var b = undefined
  console.log(isEqualMy(a, b))
  
  var a = {'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98}
  var b = {'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98}
  console.log(isEqualMy(a, b))
  
  var a = {'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98}
  var b = {'as':[1,2,4],'rt':'asdsad','yui':true,'fgh':98}
  console.log(isEqualMy(a, b))
  
  var a = {'as':[1,2,3,4],'rw':'asdsad','yui':true,'fgh':98}
  var b = {'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98}
  console.log(isEqualMy(a, b))
  
  var a = {'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98,'df':{'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98}}
  var b = {'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98,'df':{'as':[1,2,3,4],'rt':'asdsad','yui':false,'fgh':98}}
  console.log(isEqualMy(a, b))
  
  var a = {'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98,'df':{'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98}}
  var b = {'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98,'df':{'as':[1,2,3,4],'rt':'asdsad','ui':true,'fgh':98}}
  console.log(isEqualMy(a, b))

  var a = NaN
  var b = NaN
  console.log(isEqualMy(a, b))
</script>

<script type="1" id="ch04/0003">
//深度复制两个变量
function deepCopy(a) {
  if (a == null || a == undefined) {
    let b = a
    return b
  } else if (Array.isArray(a)) {
    let b = []
    for (let i = 0; i < a.length; i++) {
      b[i] = deepCopy(a[i])
    }
    return b
  } else if (a.constructor == Object) {
    let b = {}
    for (let key in a) {
      b[key] = deepCopy(a[key])
    }
    return b
  } else {
    let b = a
    return b
  }
}

var test = [1,2,3]
var ok = deepCopy(test)
console.log(ok)
test.push(7)
console.log(test)
console.log(ok)

var test = {'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98,'df':{'as':[1,2,3,4],'rt':'asdsad','yui':true,'fgh':98}}
var ok = deepCopy(test)
console.log(ok)
test.as.push(45)
console.log(test)
console.log(ok)

var test = null
var ok = deepCopy(test)
console.log(ok)
console.log(test)

var test = undefined
var ok = deepCopy(test)
console.log(ok)
console.log(test)

var test = NaN
var ok = deepCopy(test)
console.log(ok)
console.log(test)
</script>

<script type="1" id="ch04/0004">
//返回随机数
function random() {
  const date = new Date()
for (let i = 0; i < 10000; i++) {

}
  return (new Date().getTime() + 500) % 1000 / 1000
}
</script>
<script type="1" id="ch04/0005">
  function range(start, end, step = 1) {
    if (arguments.length == 1) {
      end = start
      start = 1
    }
    let data = []
    for (let i = start; step > 0 ? i <= end : i >= end; i += step) {
      data.push(i)
    }
    return data
  }

function sum (numbers) {
  let sums = 0
  for (let i of numbers) {
    sums += i
  }
  return sums
}

</script>
<script type="1" id="ch04/0006">
  function reverseArray(numbers) {
    let result = []
    let n = numbers.length - 1
    for (let i = n; i >= 0; i--) {
      result.push(numbers[i])
    }
    return result
  }

  function reverseArrayInPlace(numbers) {
    let n = numbers.length >> 1
    let temp = 0
    for (let i = 0; i < n; i++) {
      temp = numbers[i]
      numbers[i] = numbers[numbers.length - i - 1]
      numbers[numbers.length - i - 1] = temp
    }
  }
</script>

<script type="1" id="ch05/0001">
  var array = [1,2,3,4,5]
  for (let i = 0; i < array.length; i++) {
    var current = array[i]
    console.log(current)
  }

function forEach(array, action) {
  for (let i = 0; i < array.length; i++) {
    action(array[i])
  }
}

var sum = 0
forEach(array, function(number){
  sum += number
})
console.log(sum)
</script>
<script type="1" id="ch05/0002">
function greaterThan(n) {
  return function (m) {return m > n}
}
var greaterThan10 = greaterThan(10)
console.log(greaterThan10(12))
</script>
<script type="1" id="ch05/0003">
function noisy (f) {
  return function (n) {
    console.log('calling with'+ n)
     var val = f(n)
     console.log('calling with', n, val)
     return
  }
}
noisy(Boolean)(0)
</script>
<script type="1" id="ch05/0004">
function unless(test, then) {
  if(!test) then()
}
function repeat (time, body) {
  for (let i = 0; i < time; i++) {
    body(i)
  }
}

repeat(3, function(n){
  unless(n % 2, function(){
    console.log(n, 'is even!')
  }) 
})

</script>
<script type="1" id="ch05/0005">
function noisy(f) {
  return function () {
  //f.apply(null, arguments)
  f(arguments)
  //f(...arguments)
  }
}
var test = noisy(function () {
  for (let i = 0; i < arguments.length; i++) {
    console.log(arguments[i])
  }
})
test([1,2,3,4,5,6,7])
</script>
<script type="1" id="ch05/0006">
function getDerivative (f) {
  return function (x) {
    var gap = 0.000000000001
    var x1 = x - gap
    var x2 = x + gap
    var y1 = f(x1)
    var y2 = f(x2)
    return (y2 - y1) / (x2 - x1)
  }
}

var derivative = getDerivative(function (x) {
  return x * x * x
})

  derivative(2)

</script>
<script type="" id="ch05/0007">
var ANCESTRY_FILE = JSON.stringify([{
    "name": "Carolus Haverbeke",
    "sex": "m",
    "born": 1832,
    "died": 1905,
    "father": "Carel Haverbeke",
    "mother": "Maria van Brussel"
}, {
    "name": "Emma de Milliano",
    "sex": "f",
    "born": 1876,
    "died": 1956,
    "father": "Petrus de Milliano",
    "mother": "Sophia van Damme"
}, {
    "name": "Maria de Rycke",
    "sex": "f",
    "born": 1683,
    "died": 1724,
    "father": "Frederik de Rycke",
    "mother": "Laurentia van Vlaenderen"
}, {
    "name": "Jan van Brussel",
    "sex": "m",
    "born": 1714,
    "died": 1748,
    "father": "Jacobus van Brussel",
    "mother": "Joanna van Rooten"
}, {
    "name": "Philibert Haverbeke",
    "sex": "m",
    "born": 1907,
    "died": 1997,
    "father": "Emile Haverbeke",
    "mother": "Emma de Milliano"
}, {
    "name": "Jan Frans van Brussel",
    "sex": "m",
    "born": 1761,
    "died": 1833,
    "father": "Jacobus Bernardus van Brussel",
    "mother": null
}, {
    "name": "Pauwels van Haverbeke",
    "sex": "m",
    "born": 1535,
    "died": 1582,
    "father": "N. van Haverbeke",
    "mother": null
}, {
    "name": "Clara Aernoudts",
    "sex": "f",
    "born": 1918,
    "died": 2012,
    "father": "Henry Aernoudts",
    "mother": "Sidonie Coene"
}, {
    "name": "Emile Haverbeke",
    "sex": "m",
    "born": 1877,
    "died": 1968,
    "father": "Carolus Haverbeke",
    "mother": "Maria Sturm"
}, {
    "name": "Lieven de Causmaecker",
    "sex": "m",
    "born": 1696,
    "died": 1724,
    "father": "Carel de Causmaecker",
    "mother": "Joanna Claes"
}, {
    "name": "Pieter Haverbeke",
    "sex": "m",
    "born": 1602,
    "died": 1642,
    "father": "Lieven van Haverbeke",
    "mother": null
}, {
    "name": "Livina Haverbeke",
    "sex": "f",
    "born": 1692,
    "died": 1743,
    "father": "Daniel Haverbeke",
    "mother": "Joanna de Pape"
}, {
    "name": "Pieter Bernard Haverbeke",
    "sex": "m",
    "born": 1695,
    "died": 1762,
    "father": "Willem Haverbeke",
    "mother": "Petronella Wauters"
}, {
    "name": "Lieven van Haverbeke",
    "sex": "m",
    "born": 1570,
    "died": 1636,
    "father": "Pauwels van Haverbeke",
    "mother": "Lievijne Jans"
}, {
    "name": "Joanna de Causmaecker",
    "sex": "f",
    "born": 1762,
    "died": 1807,
    "father": "Bernardus de Causmaecker",
    "mother": null
}, {
    "name": "Willem Haverbeke",
    "sex": "m",
    "born": 1668,
    "died": 1731,
    "father": "Lieven Haverbeke",
    "mother": "Elisabeth Hercke"
}, {
    "name": "Pieter Antone Haverbeke",
    "sex": "m",
    "born": 1753,
    "died": 1798,
    "father": "Jan Francies Haverbeke",
    "mother": "Petronella de Decker"
}, {
    "name": "Maria van Brussel",
    "sex": "f",
    "born": 1801,
    "died": 1834,
    "father": "Jan Frans van Brussel",
    "mother": "Joanna de Causmaecker"
}, {
    "name": "Angela Haverbeke",
    "sex": "f",
    "born": 1728,
    "died": 1734,
    "father": "Pieter Bernard Haverbeke",
    "mother": "Livina de Vrieze"
}, {
    "name": "Elisabeth Haverbeke",
    "sex": "f",
    "born": 1711,
    "died": 1754,
    "father": "Jan Haverbeke",
    "mother": "Maria de Rycke"
}, {
    "name": "Lievijne Jans",
    "sex": "f",
    "born": 1542,
    "died": 1582,
    "father": null,
    "mother": null
}, {
    "name": "Bernardus de Causmaecker",
    "sex": "m",
    "born": 1721,
    "died": 1789,
    "father": "Lieven de Causmaecker",
    "mother": "Livina Haverbeke"
}, {
    "name": "Jacoba Lammens",
    "sex": "f",
    "born": 1699,
    "died": 1740,
    "father": "Lieven Lammens",
    "mother": "Livina de Vrieze"
}, {
    "name": "Pieter de Decker",
    "sex": "m",
    "born": 1705,
    "died": 1780,
    "father": "Joos de Decker",
    "mother": "Petronella van de Steene"
}, {
    "name": "Joanna de Pape",
    "sex": "f",
    "born": 1654,
    "died": 1723,
    "father": "Vincent de Pape",
    "mother": "Petronella Wauters"
}, {
    "name": "Daniel Haverbeke",
    "sex": "m",
    "born": 1652,
    "died": 1723,
    "father": "Lieven Haverbeke",
    "mother": "Elisabeth Hercke"
}, {
    "name": "Lieven Haverbeke",
    "sex": "m",
    "born": 1631,
    "died": 1676,
    "father": "Pieter Haverbeke",
    "mother": "Anna van Hecke"
}, {
    "name": "Martina de Pape",
    "sex": "f",
    "born": 1666,
    "died": 1727,
    "father": "Vincent de Pape",
    "mother": "Petronella Wauters"
}, {
    "name": "Jan Francies Haverbeke",
    "sex": "m",
    "born": 1725,
    "died": 1779,
    "father": "Pieter Bernard Haverbeke",
    "mother": "Livina de Vrieze"
}, {
    "name": "Maria Haverbeke",
    "sex": "m",
    "born": 1905,
    "died": 1997,
    "father": "Emile Haverbeke",
    "mother": "Emma de Milliano"
}, {
    "name": "Petronella de Decker",
    "sex": "f",
    "born": 1731,
    "died": 1781,
    "father": "Pieter de Decker",
    "mother": "Livina Haverbeke"
}, {
    "name": "Livina Sierens",
    "sex": "f",
    "born": 1761,
    "died": 1826,
    "father": "Jan Sierens",
    "mother": "Maria van Waes"
}, {
    "name": "Laurentia Haverbeke",
    "sex": "f",
    "born": 1710,
    "died": 1786,
    "father": "Jan Haverbeke",
    "mother": "Maria de Rycke"
}, {
    "name": "Carel Haverbeke",
    "sex": "m",
    "born": 1796,
    "died": 1837,
    "father": "Pieter Antone Haverbeke",
    "mother": "Livina Sierens"
}, {
    "name": "Elisabeth Hercke",
    "sex": "f",
    "born": 1632,
    "died": 1674,
    "father": "Willem Hercke",
    "mother": "Margriet de Brabander"
}, {
    "name": "Jan Haverbeke",
    "sex": "m",
    "born": 1671,
    "died": 1731,
    "father": "Lieven Haverbeke",
    "mother": "Elisabeth Hercke"
}, {
    "name": "Anna van Hecke",
    "sex": "f",
    "born": 1607,
    "died": 1670,
    "father": "Paschasius van Hecke",
    "mother": "Martijntken Beelaert"
}, {
    "name": "Maria Sturm",
    "sex": "f",
    "born": 1835,
    "died": 1917,
    "father": "Charles Sturm",
    "mother": "Seraphina Spelier"
}, {
    "name": "Jacobus Bernardus van Brussel",
    "sex": "m",
    "born": 1736,
    "died": 1809,
    "father": "Jan van Brussel",
    "mother": "Elisabeth Haverbeke"
}])

// This makes sure the data is exported in node.js —
// `require("./path/to/ancestry.js")` will get you the array.
if (typeof module != "undefined" && module.exports) module.exports = ANCESTRY_FILE;

</script>

<script type="1" id="ch05/0007.5">
//var string = JSON.stringify({name: 'X', born: 1980})
// console.log(string)
// console.log(JSON.parse(string).name)

var ancestry = JSON.parse(ANCESTRY_FILE)
// console.log(ancestry.length)

// function filter(array, test) {
//   let result = []
//   for (let i = 0; i < array.length; i++) {
//     if (test(array[i], i, array)) {
//       result.push(array[i])
//     }
//   }
//   return result
// }

//var peoples = filter(ancestry, people => {return (people.born > 1900 && people.born < 1925)})

// var peoples = ancestry.filter(people => {
//   return people.father == "Carel Haverbeke"})

// for (let value of peoples) {
//   console.log(value)
// }
// function map (peoples, transition) {
//   let result = []
//   for (let i = 0; i < peoples.length; i++) {
//     result.push(transition(peoples[i]))
//   }
// }

// var peoples = ancestry.filter(people => {
//   return people.died - people.born > 90
// })

// console.log(map(peoples, people => {return people.name}))
// function reduce(array, combine, start) {
//   let i = 0
//   let result = start
//   if (start == undefined) {
//     result = array[0]
//     i = 1
//   }
//   for (; i < array.length; i++) {
//     result = combine(result, array[i])
//   }
//   return result
// }

// console.log(reduce([2,2,3,4,5], (a, b) => {
//   return a + b
// }, 0))
// console.log(ancestry.reduce((old, obj) => {
//   return old.born < obj.born ? old : obj
// }))


// function average(array) {
//   let result = 0
//   for (let i = 0; i < array.length; i++) {
//     result += array[i]
//   }
//   return result / array.length
// }
// var peopleAverage = (average, age, i) => (average * i + age) / (i + 1)
// var male = people => people.sex == "m"
// var female = people => people.sex == "f"
// var age = people => people.died - people.born
// console.log('male: ' + average(ancestry.filter(male).map(age)))
// console.log('female: ' + average(ancestry.filter(female).map(age)))
// console.log('male: ' + ancestry.filter(male).map(age).reduce(peopleAverage))
// console.log('female: ' + ancestry.filter(female).map(age).reduce(peopleAverage))

// var theSet = ["Carel Haverbeke", "Maria van Brussel", "Donald Duck"]

// function isInSet(set, people) {
//   return set.indexOf(people.name) > -1
// }

// let isNamePeople = ancestry.filter((people) => {
//   return isInSet(theSet, people)
// })
// console.log(isNamePeople)

// function bind(f, ...surplus) {
//   return function (...surplus2) {
//     return f(...surplus, ...surplus2)
//   }
// }

// console.log(ancestry.filter(isInSet.bind(null, theSet)))
// console.log(ancestry.filter(bind(isInSet, theSet)))

</script>

<script type="1" id="ch05/0008">
// 课后习题第一题
var arrays = [[1,2,3,], [4,5,6,7,8], [9,10,11,]]
var arrayNew = arrays.reduce((arrayGather, array2) => arrayGather.concat(array2))
console.log(arrayNew)

arrayNew = arrays.reduce((arrayGather, array2) => arrayGather.concat(array2), [])
console.log(arrayNew)

arrayNew = [].concat(...arrays)
console.log(arrayNew)

function flatten (arrays) {
  let result = []
  // for (let i = 0; i < array.length; i++) {
  //   for (let j = 0; j < array[i].length; j++) {
  //     result.push(array[i][j])
  //   }
  // }
  for (let array1 of array) {
    for (let item of array1) {
      result.push(item)
    }
  }
  return result 
}
function flatten2 (arrays) {
  let result = []
  for (let array of arrays) {
    result.push(...array)
  }
  return result 
}
function flatten3 (arrays) {
  let result = []
  for (let array of arrays) {
    result = result.concat(...array)
  }
  return result 
}
function flatten4 (arrays) {
  let result = []
  result = arrays.reduce((result, array) => {
    return [...result, ...array]
  }, [])
  return result 
}

var arrays = [[1,2,3,[4,5,['6','7'],[8,'9']]],[10,'11',[12,[13]],[14,15]]]
function flattenDeep (arrays) {
  // let arrayNew = []
  // for (let array of arrays) {
  //   if (Array.isArray(array)) {
  //     arrayNew.push(...flatterDeep(array))
  //   } else {
  //     arrayNew.push(array)
  //   }
  // }
  // return arrayNew

  return arrays.reduce((result, array) => {
    if (Array.isArray(array)) {
      return [...result, ...flattenDeep(array)]
    } else {
      return [...result, array]
    }
  }, [])
}

</script>

<script type="1" id="ch05/0009">
// 课后习题第二题
function calculateAverage () {
  var ancestry = JSON.parse(ANCESTRY_FILE)
  let ageDiff = []
  let peopleName = {}
  let average = 0
  ancestry.forEach(people => peopleName[people.name] = people)
  let hasMother = ancestry.filter(people => peopleName[people.mother])
  ageDiff = hasMother.map(people => people.born - peopleName[people.mother].born)
  var calculate = (average, age, i) => ((average * i) + age) / (i + 1)
  average = ageDiff.reduce(calculate)
  console.log(ageDiff)
  console.log(peopleName)
  return average
}
</script>

<script type="1" id="ch05/0010">
// 课后习题第三题
function groupBy (array, screen) {
  let arrayObj = {}
  for (let i = 0; i < array.length; i++) {
    let groupName = screen(array[i], i, array)
    if (groupName in arrayObj) {
      arrayObj[groupName].push(array[i])
    } else {
      arrayObj[groupName] = [array[i]]
    }
  }
  return arrayObj
}
function averageLifetime() {
  var ancestry = JSON.parse(ANCESTRY_FILE)
  let averageLife = []
  let centuryPeople = {}
  // ancestry.forEach(people => {
  //   let century = Math.ceil(people.died / 100)
  //   if (centuryPeople[century] == undefined) {
  //     centuryPeople[century] = [people]
  //   } else {
  //     centuryPeople[century].push(people)
  //   }
  // })
  // for (let key in centuryPeople) {
  //   centuryPeople[key] = centuryPeople[key].map(people => people.died - people.born)
  //   centuryPeople[key] = centuryPeople[key].reduce((average, age, i) => (average * i + age) / (i + 1))
  // }

  centuryPeople = groupBy(ancestry, (people) => Math.ceil(people.died / 100))
  centuryPeople = mapObj(centuryPeople, (array) => {
    return array.map((people) => {
      return people.died - people.born
    }).reduce((average, age, i) => {
      return (average * i + age) / (i + 1)
    })
  })
  console.log(centuryPeople)
}
function mapObj(obj, mapper) {
  let result = {}
  for (let key in obj) {
    result[key] = mapper(obj[key], key, obj)
  }
  return result
}
</script>
<script type="1" id="ch05/0011">
//课后第4题
array = [1,2,3,4,5,6]
var judge = (item) => item > 0

function every (array, judge) {
  for (let i = 0; i < array.length; i++) {
    if (!judge(array[i], i, array)) {
      return false 
    }
  }
  return true
}
function some (array, judge) {
  for (let i = 0; i < array.length; i++) {
    if (judge(array[i], i, array)) {
      return true 
    }
  }
  return false
}
function every2 (array, judge) {
  return array.reduce((result, item) => {
    return result && judge(item)
  }, true)
}
function some2(array, judge) {
  return array.reduce((result, item) => {
    return result || judge(item)
  }, false)
}

function every3(array,judge) {
  return !array.reduce((result, item) => {
    return result || !judge(item)
  }, false)
}
function every4(array, judge) {
  return !some(array, (...item) => !judge(...item))
}
function negate (f) {
  return function (...arg) {
    return !f(...arg)
  }
}
function every5(array,judge) {
  return !some(array, negate(judge))
}
function isOdd(x) {
  return x % 2 == 0
}
var isEven = negate(isOdd)
</script>
<script type="1" id="ch05/0012">
//各种排序

function judgeOrder(array) {
  for (let i = 1; i < array.length; i++) {
    if (array[i - 1] > array[i]) {
      return false
    }
  }
  console.log(array)
  return true
}
function judgeOrderBy(array, myMap = it => it) {
  for (let i = 1; i < array.length; i++) {
    if (myMap(array[i - 1]) > myMap(array[i])) {
      return false
    }
  }
  console.log(array)
  return true
}
function myRandomArray(length) {
  let array = []
  for (let i = 0; i < length; i ++) {
    if (i % 2 == 0) {
      array.push(-(Math.random() * 100 | 0))
    } else {
      array.push(Math.random() * 100 | 0)
    }
  }
  // console.log(array)
  return array
}
var nums = [3,6,8,23,435,8,98,41,5,6,8,8,3,2,2435,7,85,3,24,6,785,82,21,15,3,6]
function bubbleSort(nums) {
  let n = nums.length - 1
  let temp = 0
  let end = true
  for (let i = n; i >= 0; i--) {
    end = true
    for (let j = 1; j <= i; j++) {
      if (nums[j - 1] > nums[j]) {
        swap(nums, j - 1, j)
        end = false
      }
    }
    if (end == true) {
      break
    }
  }
  return nums
}
function bubbleSortBy(nums, predicate = it => it) {
  let isSort = true
  for (let i = nums.length; i > 0; i--) {
    isSort = true
    for (let j = 1; j < i; j++) {
      if (predicate(nums[j - 1]) > predicate(nums[j])) {
        swap(nums, j - 1, j)
        isSort = false
      }
    }
    if (isSort == true) {
      break
    }
  }
  // console.log(nums)
  return nums
}
function bubbleSortWith (nums, compare = (it1, it2) => {return it1 > it2}) {
  let isSort = true
  for (let i = nums.length; i > 0; i--) {
    isSort = true
    for (let j = 1; j < i; j++) {
      if (compare(nums[j - 1], nums[j]) > 0) {
        swap(nums, j - 1, j)
        isSort = false
      }
    }
    if (isSort == true) {
      break
    }
  }
  return nums
}
//judgeOrder(bubbleSort(myRandomArray(100)))
function selectSort (nums) {
  let minIndex = -1
  for (let left = 0; left < nums.length - 1; left++) {
    minIndex = left
    for (let i = left + 1; i < nums.length; i++) {
      if (nums[i] < nums[minIndex]) {
        minIndex = i
      }
    }
    if (minIndex != left) {
      swap(nums, left, minIndex)
    }
  }
  return nums
}

function selectSortBy (nums, predicate = it => it) {
  let minIndex = 0
  for (let left = 0; left < nums.length - 1; left++) {
    minIndex = left
    for (let i = left + 1; i < nums.length; i++) {
      if (predicate(nums[minIndex]) > predicate(nums[i])) {
        minIndex = i
      }
    }
    if (minIndex != left) {
      swap(nums, minIndex, left)
    }
  }
  return nums
}
function selectSortWith (nums, compare = (it1, it2) => it1 - it2) {
  let minValIdx = 0
  for (let left = 0; left < nums.length - 1; left++) {
    minValIdx = left
    for (let i = left + 1; i < nums.length; i++) {
      if (compare(nums[minValIdx], nums[i]) > 0) {
        minValIdx = i
      }
    }
    if (minValIdx != left) {
      swap(nums, minValIdx, left)
    }
  }
  return nums
}

function insertSort(nums) {
  let index
  for (let i = 1; i < nums.length; i++) {
    index = i
    while (index >= 1 && nums[index - 1] > nums[index]) {
      swap(nums, index, index - 1)
      index--
    }
  }
  return nums
}

function insertSortBy (nums, predicate = it => it) {
  let index = 0
  for (let left = 1; left < nums.length; left++) {
    index = left
    while (index > 0 && predicate(nums[index - 1]) > predicate(nums[index])) {
      swap(nums, index - 1, index)
      index--
    }
  }
  return nums
}

function insertSortWith (nums, compare = (it1, it2) => it1 - it2) {
  let index = 0
  for (let left = 1; left < nums.length; left++) {
    index = left
    while (index > 0 && compare(nums[index - 1], nums[index]) > 0) {
      swap(nums, index - 1, index)
      index--
    }
  }
  return nums
}

function mergeSort (nums) {
  if (nums.length < 2) {
    return nums
  }
  let leftArray = []
  let rightArray = []
  let middle = nums.length >>> 1
  leftArray = nums.slice(0, middle)
  rightArray = nums.slice(middle)

  mergeSort(leftArray)
  mergeSort(rightArray)

  let left = 0
  let right = 0
  let store = 0
  while (left < leftArray.length && right < rightArray.length) {
    if (leftArray[left] <= rightArray[right]) {
      nums[store] = leftArray[left]
      left++
      store++ 
    } else {
      nums[store] = rightArray[right]
      right++
      store++
    }
  }

  while (left < leftArray.length) {
    nums[store] = leftArray[left]
    left++
    store++ 
  }
  while (right < rightArray.length) {
    nums[store] = rightArray[right]
    right++
    store++
  }
  return nums
}
function mergeSortBy (nums, predicate = it1 => it1) {
  if (nums.length < 2) {
    return nums
  }
  let middle = nums.length >>> 1
  let leftArray = nums.slice(0, middle)
  let rightArray = nums.slice(middle)

  mergeSortBy(leftArray, predicate)
  mergeSortBy(rightArray, predicate)

  let left = 0
  let right = 0
  let store = 0
  while (left < leftArray.length && right < rightArray.length) {
    if (predicate(leftArray[left]) <= predicate(rightArray[right])) {
      nums[store++] = leftArray[left++]
    } else {
      nums[store++] = rightArray[right++]
    }
  }
  while (left < leftArray.length) {
    nums[store++] = leftArray[left++]
  }
  while (right < rightArray.length) {
    nums[store++] = rightArray[right++]
  }
  return nums
}
function mergeSortWith (nums, compare = (it1, it2) => it1 - it2) {
  if (nums.length < 2) {
    return nums
  }
  let middle = nums.length >>> 1
  let leftArray = nums.slice(0, middle)
  let rightArray = nums.slice(middle)

  mergeSortWith(leftArray, compare)
  mergeSortWith(rightArray, compare)

  let left = 0
  let right = 0
  let store = 0
  while (left < leftArray.length && right < rightArray.length) {
    if (compare(leftArray[left], rightArray[right]) < 0) {
      nums[store++] = leftArray[left++]
    } else {
      nums[store++] = rightArray[right++]
    }
  }
  while (left < leftArray.length) {
    nums[store++] = leftArray[left++]
  }
  while (right < rightArray.length) {
    nums[store++] = rightArray[right++]
  }
  return nums
}
function quickSort (nums) {
  if (nums.length < 2) {
    return nums
  }
  let piquetIdx = (Math.random() * nums.length) | 0
  let piquet = nums[piquetIdx]
  let leftArray = []
  let rightArray = []
  let middleArray = []
  for (let i = 0; i < nums.length; i++) {
    if (nums[i] < piquet) {
      leftArray.push(nums[i])
    } else if (nums[i] === piquet) {
      middleArray.push(nums[i])
    } else {
      rightArray.push(nums[i])
    }
  }
  quickSort(leftArray)
  quickSort(rightArray)

  let idx = 0
  for (let i = 0; i < leftArray.length; i++) {
    nums[idx++] = leftArray[i]
  }
  for (let i = 0; i < middleArray.length; i++) {
    nums[idx++] = middleArray[i]
  }
  for (let i = 0; i < rightArray.length; i++) {
    nums[idx++] = rightArray[i]
  }
  return nums
}
function quickSortWith (nums, compare = (it1, it2) => it1 - it2) {
  if (nums.length < 2) {
    return nums
  }
  let piquetIdx = Math.random() * nums.length | 0
  let piquet = nums[piquetIdx]
  let leftArray = []
  let rightArray = []
  let piquetArray = []
  for (let i = 0; i < nums.length; i++) {
    if (compare(nums[i], piquet) < 0) {
      leftArray.push(nums[i])
    } else if (compare(nums[i], piquet) == 0) {
      piquetArray.push(nums[i])
    } else {
      rightArray.push(nums[i])
    }
  }

  quickSortWith(leftArray, compare)
  quickSortWith(rightArray, compare)

  let index = 0
  for (let i = 0; i < leftArray.length; i++) {
    nums[index++] = leftArray[i]
  }
  for (let i = 0; i < piquetArray.length; i++) {
    nums[index++] = piquetArray[i]
  }
  for (let i = 0; i < rightArray.length; i++) {
    nums[index++] = rightArray[i]
  }
  return nums
}

function quickSort2 (nums, left = 0, right = nums.length) {
  if (right - left < 2) {
    return nums
  }
  let piquetIdx = (Math.random() * (right - left) + left) | 0
  let piquet = nums[piquetIdx]

  swap(nums, piquetIdx, right - 1)
  let i = left
  for (let j = left; j < right - 1; j++) {
    if (nums[j] < piquet) {
      swap(nums, i, j)
      i++
    }
  }
  swap(nums, i, right - 1)

  quickSort2(nums, left, i)
  quickSort2(nums, i + 1, right)

  return nums
}

function quickSort2InPlaceWith (nums, compare = (it1, it2) => it1 - it2, start = 0, end = nums.length) {//快速排序,但增加了等于哨兵的值的排序,用了compare
  if (end - start < 2) {
    return nums
  }
  let piquetIdx = (Math.random() * (end - start) + start) | 0
  let piquet = nums[piquetIdx]

  nums[piquetIdx] = nums[end - 1]
  nums[end - 1] = piquet
  let left = start
  for (let i = start; i < end - 1; i++) {
    if (compare(nums[i], piquet) < 0) {
      if (left != i) {
        swap(nums, left, i)
      }
      left++
    }
  }
  let equalIdx = left
  for (let i = equalIdx; i < end - 1; i++) {
    if (compare(nums[i], piquet) == 0) {
      if (i != equalIdx) {
        swap(nums, i , equalIdx)
      }
      equalIdx++
    }
  }

  nums[end - 1] = nums[equalIdx]
  nums[equalIdx] = piquet
  quickSort2InPlaceWith(nums, compare, start, left)
  quickSort2InPlaceWith(nums, compare, equalIdx + 1, end)

  return nums
}

function quickSortInPlace (nums, left = 0, right = nums.length) { //快速排序,但增加了等于哨兵的值的排序
  if (right - left < 2) {
    return nums
  }
  let piquetIdx = (Math.random() * (right - left) + left) | 0
  let piquet = nums[piquetIdx]

  swap(nums, piquetIdx, right - 1)
  let i = left
  for (let j = left; j < right - 1; j++) {
    if (nums[j] < piquet) {
      swap(nums, i, j)
      i++
    }
  }

  let n = i
  for (let m = i; m < right - 1; m++) {
    if (nums[m] == piquet) {
        swap(nums, m, n)
        n++
    }
  }

//   swap(nums, i, right - 1)
  swap(nums, n, right - 1)

  quickSortInPlace(nums, left, i)
  quickSortInPlace(nums, n + 1, right)

  // quickSortInPlace(nums, left, i)
  // quickSortInPlace(nums, i + 1, right)
  return nums
}
</script>
<script type="1" id="ch05/0005656">
//快速排序,原地排序,把数组分成三份
function quickSort4(array, start = 0, end = array.length) {
  if (end - start < 2) {
    return false
  }
  let piquetIdx = (Math.random() * (end - start) + start) | 0
  let piquet = array[piquetIdx]
  let small = start
  let same = start
  swap(array, piquetIdx, end - 1)

  for (let i = start; i < end - 1; i++) {
    if (array[i] < piquet) {
      swap(array, same, small)
      if (same != i) {
        swap(array, i, small)
      }
      small++
      same++
    } else if (array[i] == piquet) {
      swap(array, i, same)
      same++
    }
  }
  swap(array, same, end - 1)

  quickSort4(array, start, small)
  quickSort4(array, same + 1, end)

  return array
}
function quickSort5(array, start = 0, end = array.length) {
  if (end - start < 2) {
    return false
  }
  let piquetIdx = (Math.random() * (end - start) + start) | 0
  let piquet = array[piquetIdx]
  let small = start
  let large = end - 2
  swap(array, piquetIdx, end - 1)

  for (let i = start; i <= large; i++) {
    if (array[i] < piquet) {
      swap(array, i, small)
      small++
    } else if (array[i] > piquet) {
      swap(array, i, large)
      large--
      i--
    }
  }
  swap(array, large + 1, end - 1)

  quickSort5(array, start, small)
  quickSort5(array, large + 2, end)

  return array
}
</script>
<script type="1" id="ch04/0007">
  //上课时,临时写的,后面还有课下写的
  function arrayToList (array) {
    let obj = []
    for (let i = 0; i < array.length; i++) {
      obj[value]
    }
  }
  function listToArray(head) {
    let array = []
    if (head.next == null) {
      return head.val
    }

    array.push(head.val)
    array.push(...listToArray(head.next))

    return array
  }
  function listToArray(head) {
    let array = []
    if (head == null) {
      return array
    }
    
    while (head != null) {
      array.push(head.val)
      head = head.next
    }
    return array
  }
function prepend (val, head) {
  if (head == null) { //不用这个if
    return null
  }
  let list = {
    value: val,
    next:head
  }
  return list

}
function addpend (val, head) {
let node = head
  while (true){
    if (head.next != null) {
      head = head.next
    } else {
      break
    }
  }
  head.val = val
  return node
}
function nth(head, idx) {
  if (idx == 0 || head == null){
    return head.val //undefined
  }
  nth(head = head.next, idx--)
  return head.val
}
</script>
<script type="1" id="ch04/0008">
//链表,课下写的
// function arrayToList(array) {
//   let head = {
//     val: 0,
//     next: null,
//   }
//   let node = head

//   for (let value of array) {
//     node.next = {
//       val: value,
//       next: null
//     }
//     node = node.next
//   }
//   return head.next
// }

function arrayToList(array){
  if (array.length == 0) {
    return null
  }

  let head = {
    val: array[0],
    next: arrayToList(array.slice(1))
  }

  return head
}

// function listToArray(head) {
//   if (head == null) {
//     return []
//   }
//   let array = []

//   while(head) {
//     array.push(head.val)
//     head = head.next
//   }

//   return array
// }

function listToArray(head) {
  if (head == null) {
    return []
  }
  let array = []
  if (head.next == null) {
      array.push(head.val)
      return array
  }
  //let array2 = listToArray(head.next)
  // array.push(head.val, ...array2)

  array.push(head.val, ...listToArray(head.next))

  // array.push(head.val)
  // for (let value of array2) {
  //   array.push(value)
  // }


  return array
}

function prepend(val, head) {
  let node = {
    val: val,
    next: head,
  }

  return node
}

// function append(val, head) {
//   let node = head
//   let endNode = {
//     val: val,
//     next: null
//   }
//   if (head == null) {
//     return endNode
//   }

//   while (node.next) {
//     node = node.next
//   }
//   node.next = endNode
//   return head
// }

function append(val, head) {

  if (head == null){
      let endNode = {
      val: val,
      next: null,
    }
    return endNode
  }

  head.next = append(val, head.next)

  return head
}

function nth(head, idx) {
  while(idx > 0 && head) {
    head = head.next
    idx--
  }
  if (head != null && idx == 0) {
    return head.val
  } else {
    return undefined
  }
}

// function nth(head, idx) {
//   if(idx < 0) {
//     return undefined
//   }
//   if (head == null) {
//     return undefined
//   }
//   if (idx == 0) {
//     return head.val
//   }
  
//   return nth(head.next, --idx)
// }

function insert(head, idx, value) {
  let node = head
  let newNode = {
    val: value,
    next: null,
  }
  if (idx < 0) {
    return null
  }
  if (idx == 0) {
    newNode.next = head
    return newNode
  }

  while (idx > 1 && node) {
    idx--
    node = node.next
  }
  if (node != null && idx == 1) {
    newNode.next = node.next
    node.next = newNode
  } else {
    return null
  }

  return head
} 

function remove(head, idx) {
  let node = head
  if (idx < 0) {
    return null
  }
  if(idx == 0) {
    head = head.next
    return head
  }

  while(idx > 1 && node.next) {
    node = node.next
    idx--
  }
  if (node.next && idx == 1) {
    node.next = node.next.next
  } else {
    return null
  }

  return head
}
</script>
<script type="1" id="000000">
  //上课时写快速排序,前面有自己下课时写的
function quickSort(array) {
  let random = Math.random()
  let leftArray = []
  let rightArray = []
  for (let value of array) {
    if (value < random) {
      leftArray.push(value)
    } else {
      rightArray.push(value)
    }
  }
  leftArray = quickSort(leftArray)
  rightArray = quickSort(rightArray)

  while(){

  }
}
</script>

<script type="1" id="ch05/00013">
  //第五章,曾曾曾祖父那一节

  // function keyBy(array, test) {
  //   let obj = {}
  //   for (let i = 0; i < array.length; i++) {
  //     let key = test(array[i], i, array)
  //     obj[key] = array[i]
  //   }
  //   return obj
  // }


  var ancestry = JSON.parse(ANCESTRY_FILE)

  var byName = {}

  ancestry.forEach(person => {
    byName[person.name] = person
  })

  // function reduceAncestors (person) {
  //   if (!person) {
  //     return 0
  //   }
  //   if(person.name == "Pauwels van Haverbeke") {
  //     return 1
  //   }
  //   return (reduceAncestors(byName[person.father]) + reduceAncestors(byName[person.mother])) / 2
  // }
  // return reduceAncestors(byName["Philibert Haverbeke"])

  function reduceAncestors (person, f, defaultValue) {
    function valueFor(person) {
      if (!person) {
        return defaultValue
      }
  
      return f(person, valueFor(byName[person.father]), 
                        valueFor(byName[person.mother]))
    }
    return valueFor(person)

  }

  function sharedDNA (person, fother, mother) {
    if (person.name == "Pauwels van Haverbeke") {
      return 1
    }
    return (fother + mother) / 2
  }

  // var by = byName["Philibert Haverbeke"]
  // reduceAncestors(by, sharedDNA, 0)

  function countAncestors(person, test) {
    function combine (person, fromFother, fromMother) {
      let thisOneCount = test(person)
      return thisOneCount + fromFother + fromMother
    }

    return reduceAncestors(person, combine, 0)
  }

  function longLivingPercentage (person) {
    var all = countAncestors(person, (person) => true)
    var longLiving = countAncestors(person, (person) => person.died - person.born >= 70)
    return longLiving / all
  }
  console.log(longLivingPercentage(byName["Emile Haverbeke"]))

</script>

<script type="1" id="ch06/00001">
  // var rabbit = {}
  // rabbit.speak = function (line) {
  //   console.log("The rabbit says '" + line + "'")
  // }
  // rabbit.speak("I'm alive.")

  function speak (line) {
    console.log("The " + this.type + " rabbit says '" + line + "'")
  }

  var whiteRabbit = {type: "white", speak: speak}
  var fatRabbit = {type: "fat", speak: speak}

  whiteRabbit.speak("Oh my ears and whiskers, " + "how late it's getting!")
  fatRabbit.speak("I could sure usa a carrot right now.")

  speak("123")
  speak.call(whiteRabbit, "yes")
  speak.apply({type: "old"}, ["hahaha"])
  speak("哇偶")
  console.log(Object.getPrototypeOf(speak.prototype))
</script>

<script type="1" id="ch06/00002">
  var empty = {}
  console.log(empty.toString)
  console.log(empty.toString())
  console.log(Object.getPrototypeOf({}) === Object.prototype)
  console.log(Object.getPrototypeOf(Object.prototype))
  console.log(Object.getPrototypeOf(isNaN) === Function.prototype)
  console.log(Object.getPrototypeOf(Function.prototype))
  console.log(Object.prototype)
  console.log(Function.prototype)
  console.log(Array.prototype)
  console.log(Object.getPrototypeOf(Array.prototype))
  console.log(String.prototype)
  console.log(Object.getPrototypeOf(String.prototype))
  var protoRabbit = {
    speak: function (line) {
      console.log("The " + this.type + " rabbit syas '" + line + "'")
    }
  }
  var killerRabbit = Object.create(protoRabbit)
  killerRabbit.type = "killer"
  killerRabbit.speak("SKEEEE!")
  console.log(killerRabbit.speak)

  function Rabbit(type) {
    this.type = type
  }

  var killerRabbit = new Rabbit("killer")
  var blackRabbit = new Rabbit("black")
  console.log(blackRabbit.type)
  console.log(Object.getPrototypeOf(killerRabbit))
  console.log(Object.getPrototypeOf(Rabbit) === Function.prototype)
  Rabbit.prototype.speak = function speak (line) {
    console.log("The " + this.type + " rabbit says '" + line + "'")
  }
  // protoRabbit = {
  //   speak: function speak(link) {
  //   console.log("The " + this.type + " rabbit says '" + line + "'")
  //   }
  // }
  // Rabbit.prototype = protoRabbit
  //killerRabbit.speak("I'm killer")

  console.log(Object.getPrototypeOf(killerRabbit))
</script>
<script type="1" id="ch06/0003">
  function forOwn (obj, action) {
    for(let key in obj) {
      if (Object.prototype.hasOwnProperty.call(obj, key))
      action(key)
    }
  }
  function Rabbit (type) {
    this.type = type
  }
  let killerRabbit = new Rabbit("killer")
  let blackRabbit = new Rabbit("black")
  Rabbit.prototype.teeth = "small"
  console.log(killerRabbit.teeth)
  killerRabbit.teeth = "long sharp, and bloody"
  console.log(killerRabbit.teeth)
  console.log(blackRabbit.teeth)
  console.log(Rabbit.prototype.teeth)
  console.log(Object.prototype.toString.call([1,2]))
  Rabbit.prototype.dance = function () {
    console.log("The " + this.type +" rabbit dances a jig")
  }
  killerRabbit.dance()
  console.log(killerRabbit)
  Object.defineProperty(Rabbit.prototype, "hiddenNosense", {enumerable: false, value: "hi"})
  for (let key in killerRabbit) {
    console.log(key)
  }
  console.log(("hiddenNosense" in killerRabbit) )
  console.log(killerRabbit.hasOwnProperty("dance"))
  console.log(Object.prototype.hasOwnProperty.call(killerRabbit, "dance"))
  console.log(Object.prototype.hasOwnProperty.call(killerRabbit, "teeth"))
  var map = Object.create(null) 
  map["pizza"] = 0.069
  console.log("pizza" in map)
  console.log("toString" in map)
  console.log(map)
</script>
<script type="1" id="ch06/0004">

var MOUNTAINS = [{
    name: "Kilimanjaro",
    height: 5895,
    country: "Tanzania"
}, {
    name: "Everest",
    height: 8848,
    country: "Nepal"
}, {
    name: "Mount Fuji",
    height: 3776,
    country: "Japan"
}, {
    name: "Mont Blanc",
    height: 4808,
    country: "Italy/France"
}, {
    name: "Vaalserberg",
    height: 323,
    country: "Netherlands"
}, {
    name: "Denali",
    height: 6168,
    country: "United States"
}, {
    name: "Popocatepetl",
    height: 5465,
    country: "Mexico"
}];

function rowHeights ( rows ) {
  return rows .map( function (row) {
    return row. reduce ( function (max , cell ) {
      return Math .max(max , cell . minHeight ());
    }, 0);
  });
}

function colWidths ( rows ) {
  return rows [0]. map( function (_, i) {
    return rows . reduce ( function (max , row) {
      return Math .max(max , row[i]. minWidth ());
    }, 0);
  });
}

function drawTable ( rows ) {
  var heights = rowHeights ( rows );
  var widths = colWidths ( rows );
  function drawLine (blocks , lineNo ) {
    return blocks .map( function ( block ) {
      return block [ lineNo ];
    }). join (" ");
  }
  function drawRow (row , rowNum ) {
    var blocks = row.map( function (cell , colNum ) {
      return cell . draw ( widths [ colNum ], heights [ rowNum ]);
  });

    return blocks [0]. map( function (_, lineNo ) {
      return drawLine (blocks , lineNo );
    }). join ("\n");
  }
  return rows .map( drawRow ). join ("\n");
}


  function repeat (string, times) {
    let result = ""
    for (let i = 0; i < times ; i++) {
      result += string
    }
    return result
  }
  function TextCell (text) {
    this.text = text.split("\n")
  }

  TextCell.prototype.minWidth = function() {
    return this.text.reduce((width, line) => {
      return Math.max(width, line.length)
    }, 0)
  }
  TextCell.prototype.minHeight = function () {
    return this.text.length
  }
  TextCell.prototype.draw = function (width, height) {
    let result = []
    for (let i = 0; i < height; i++) {
      let line = this.text[i] || ""
      result.push(line + repeat(" ", width - line.length))
    }
    return result
  }

  // let rows = []
  // for (let i = 0; i < 5; i++) {
  //   let row = []
  //   for (let j = 0; j < 5; j++) {
  //     if ((i + j) % 2 == 0) {
  //       row.push(new TextCell("##"))
  //     } else {
  //       row.push(new TextCell("  "))
  //     }
  //   }
  //   rows.push(row)
  // }
  // console.log(rows)
  // console.log(drawTable(rows))

  function UnderlinedCell (inner) {
    this.inner = inner
  }
  UnderlinedCell.prototype.minWidth = function () {
    return this.inner.minWidth()
  }
  UnderlinedCell.prototype.minHeight = function () {
    return this.inner.minHeight() + 1
  }
  UnderlinedCell.prototype.draw = function (width ,height) {
    return (this.inner.draw(width, height - 1)
          .concat([repeat('-', width)]))
  }

  function dataTable(data) {

    let keys = Object.keys(data[0])
    let heads = keys.map(name => {
      return new UnderlinedCell(new TextCell(name))
    })
    let body = data.map(row => {
      return keys.map(key => {
        return new TextCell(String(row[key]))
      })
    })

    return [heads].concat(body)

  }
  console.log(drawTable(dataTable(MOUNTAINS)))
</script>
<script type="1" id="ch06/0005">
  function Vector (x, y) {
    this.x = x
    this.y = y
  }

  Vector.prototype.plus = function (vector) {
    return new Vector(this.x + vector.x, this.y + vector.y)
  }
  Vector.prototype.minus = function (vector) {
    return new Vector(this.x - vector.x, this.y - vector.y)
  }
  Vector.prototype.length = function () {
    return Math.sqrt(this.x * this.x + this.y * this.y)
  }

  var v1 = new Vector(1, 2)
  var v2 = new Vector(3, -4)

  var v3 = v1.plus(v2)
  var v4 = v2.minus(v1)

  var l = v4.length()
  console.log(v1)
  console.log(v2)
  console.log(v3)
  console.log(v4)
  console.log(l)

</script>
<script type="1" id="ch06/0006">
function Complex (real, imag) {
  this.real = real
  this.imag = imag
}

Complex.prototype.toString = function() {
  //console.log(this.real + "+" + this.imag + "i")
  return "" + this.real + (this.imag > 0 ? "+" : "") + this.imag + "i"
}
Complex.prototype.plus = function (complex) {
  return new Complex((this.real + complex.real), (this.imag + complex.imag))
}
Complex.prototype.minus = function (complex) {
  return new Complex((this.real - complex.real), (this.imag - complex.imag))
}
Complex.prototype.multiple = function (complex) {
  return new Complex((this.real * complex.real - this.imag * complex.imag), (this.real * complex.imag + this.imag * complex.real))
}

Complex.prototype.div = function () {
  
}


// (a + bi) - (c + di)
// (a - c) + (b - d)i

// (a + bi)(c + di)
// ac + adi + bci + bdi^2
// (ac - bd) + (adi + bci)

var c1 = new Complex(4, 5)
var c2 = new Complex(1, -2)

var c3 = c1.plus(c2)
var c4 = c1.minus(c2)
var c5 = c1.multiple(c2)
//var c6 = 
console.log(c1)
console.log(c2)
console.log(c3)
console.log(c4)
console.log(c5)
c5.toString()
</script>
<script type="1" id="0000001">
//汉诺塔游戏的步数计算
  var number = 6
  function tower (num) {
    if (num == 1) {
      return 1
    }
    return  2 * tower(num - 1) + 1
  }
  console.log(tower(number))
</script>
<script type="1" id="ch06/0007">
//二叉树,上课写的代码,下面有课下写的代码
  function arrayToTree (array, pos = 0) {
    if (array[pos] == null) {
      return null
    }
    let node = new TreeNode(array[pos])

    node.left = arrayToTree(array, pos * 2 + 1)
    node.rught = arrayToTree(array, pos * 2 + 2)

    return node
  }
  function treeToArray (root) {
    let result = []

    result.push(root.val)
    result

  }
  function condensedArrayToTree (array) {

  }
  function treeCondensedArray(root) {
    let array = []
    let tempArray = []

    array.push(root.val)
    tempArray.push(root)

    while (tempArray.length) {
      node = tempArray.shift()
      if (node.left == null) {
        array.push(null)
      } else {
        array.push(node.left.val)
        tempArray.push(node.left)
      }

      if (node.right == null) {
        array.push(null)
      } else {
        array.push(node.right.val)
        tempArray.push(node.right)
      }
    }

    return array

  }
  遍历二叉树
</script>

<script type="1" id="ch06/0008">
  //二叉树
class TreeNode {
  constructor (val, left, right) {
    this.val = (val === undefined) ? 0 : val
    this.left = (left === undefined) ? null : left
    this.right = (right === undefined) ? null : right
  }
}

function arrayToTree (array, position = 0) {
  if (array[position] == undefined) {
    return null
  }

  let node = new TreeNode(array[position])
  node.left = arrayToTree(array, position * 2 + 1)
  node.right = arrayToTree(array, position * 2 + 2)

  return node
}
function treeToArray (tree, array = [], index = 0) {
  if (tree == null) {
    return null
  }
  array[index] = tree.val

  treeToArray(tree.left, array, index * 2 + 1)
  treeToArray(tree.right, array, index * 2 + 2)

  return array
}

function condensedArrayToTree (array) {
  if (array.length == 0) {
    return null
  }
  let nodeArray = []
  let index = 0
  let root = new TreeNode(array[0])
  nodeArray.push(root)
  
  let node = null
  for (let i = 1; i < array.length; i += 2) {
    node = nodeArray[index++]
    if (array[i] == null) {
      node.left = null
    } else {
      node.left = new TreeNode(array[i])
      nodeArray.push(node.left)
    }

    if (array[i + 1] == null) {
      node.right = null
    } else {
      node.right = new TreeNode(array[i + 1])
      nodeArray.push(node.right)
    }

  }
  return root
}

function treeToCondensedArray (tree) {
  let array = []
  if (tree == null) {
    return array
  }

  let nodeArray = []
  let index = 0
  let node = null

  nodeArray.push(tree)
  while (nodeArray.length > index) {
    node = nodeArray[index++]
    if (node == null) {
      array.push(null)
    } else {
      array.push(node.val)
      nodeArray.push(node.left, node.right)
    }
    // if (node) {
    //   array.push(node.val)
    //   nodeArray.push(node.left, node.right)
    // } else {
    //   array.push(node)
    // }
  }

  return array
}

function traverseTree1 (tree, func) {
  if (tree == null) {
    return null
  }
  func(tree.val)
  traverseTree1(tree.left, func)
  traverseTree1(tree.right, func)
}

function traverseTree2 (tree, func) {
  if (tree == null) {
    return null
  }
  traverseTree2(tree.left, func)
  func(tree.val)
  traverseTree2(tree.right, func)
}

function traverseTree3 (tree, func) {
  if (tree == null) {
    return null
  }
  traverseTree3(tree.left, func)
  traverseTree3(tree.right, func)
  func(tree.val)
}

function traverseTree4 (tree) {
  if (tree == null) {
    return []
  }
  let value = tree.val
  let left = traverseTree4(tree.left)
  let right = traverseTree4(tree.right)

  return [value, ...left, ...right]
}
</script>
<script type="1" id="ch08/0001">
  //递归层数
var count = 0
function describe(description, func) {
  let result = ""
  for (let i = 0; i < count; i++) {
    result += "  "
  }
  console.log(result + description)

  count++
  func()
  count--
}

<!-- 实现以上函数，已让下面的调用能够输出最后的效果 -->
describe('foo', () => {
  describe('bar', () => {})
  describe('bar', () => {
    describe('bar1', () => {})
    describe('bar1', () => {})
    describe('bar1', () => {})
  })
  describe('bar', () => {})
})

// foo
//   bar
//   bar
//     bar1
//     bar1
//     bar1
//   bar

</script>
<script type="1" id="ch08/0002">
  var context = null
  function withContext (newContext, body) {
    var oldContext = context
    context = newContext
    try {
      return body()
    } finally {
      context = oldContext
    }
  }

  try{
    withContext (5, () => {
      if (context < 10) {
        throw new Error("Not enough context!")
      }
    })
  } catch (e) {
    console.log("Ignoting: " + e)
  }
  console.log(context)

</script>
<script type="1" id="ch08/0003">
  function InputError (message) {
    this.message = message
    this.stack = (new Error()).stack
  }
  InputError.prototype = Object.create(Error.prototype)
  InputError.prototype.name = "InputError"

  function promptDirection (question) {
    var result = prompt(question, "")
    if (result.toLowerCase() == "left") return "L"
    if (result.toLowerCase() == "right") return "R"
    throw new InputError("Invalid direction: " + result)
  }

</script>
<script type="1" id="ch08/0004">
  //课后作业
  // function MultiplicationUnitFailure (text) {
  //   this.message = text
  //   this.stack = (new Error()).stack
  // }
  // MultiplicationUnitFailure.prototype = Object.create(Error.prototype)
  // MultiplicationUnitFailure.prototype.name = "MultiplicationUnitFailure"

  class MultiplicationUnitFailure extends Error {
    constructor (text) {
      super(text)
    }
  }

  function primitiveMultiply (x, y) {
    if (Math.random() > 0.5) {
      return x * y
    } else {
      throw new MultiplicationUnitFailure("计算出错了,请重试")
    }
  }

  function tryMultiply(x, y) {
    // for (;;) {
      try{
        return primitiveMultiply(x, y)
      } catch (e) {
        if (e instanceof MultiplicationUnitFailure) {
          console.log(e.message)
          return tryMultiply(x, y)
        } else {
          throw e
        }
      }
    // }
  }

var box = {
  locked: true,
  unlock: function () {this.locked = false},
  lock: function () {this.locked = true},
  _content: [1,2],
  get content() {
    if (this.locked) {
      return new Error("Locked!")
    } else {
      return this._content
    }

  }
}

function withBoxUnlocked(func) {
  box.unlock()
  console.log(box.locked)
  try{
    func(box)
    console.log(1111)
  } finally {
    box.lock()
  }
}

function tryUnlock() {
  try{
    withBoxUnlocked((box) => {
      console.log(box.content)
    })
  } catch (e) {
      console.log(e.message)
  }
  console.log(box.locked)
}

function openFile(...arg) {
  let func = arg.pop()
  try{
    func(...arg)
  } finally {
    arg.forEach(it => it.__colse__())
  }
}

operationFile(open("a"), open("b"), (a, b) => {

})
</script>
<script type="1" id="ch08/0005">
  //二叉数,二叉搜索树或二叉排序数
  function insertInToBST(root, val) {
    if (root == null) {
      return new TreeNode(val)
    }
    if (root.val > val) {
      root.left = insertInToBST(root.left, val)
    }else {
      root.right = insertToInBST(root.right, val)
    }
    return root
  }
</script>
<script type="1" ch08/0006>
  //上课写的堆相关的,后面有课下写的
  {
      向下调整(idx) {
          while (idx < num.length - 1) {
              if (num[idx] < num[idx * 2 + 1]) {
                  swap()
              } else if (num[idx] < num[idx * 2 + 2]) {
                  swap()
              } else {
                  break
              }
          }
      }
  }
</script>
<script type="1" id="ch08/0007">
// 堆 数据结构
class PriorityQueue {
  #items = null
  #predicate = null
  constructor (array = [], predicate = it => it) {
    this.#items = []
    this.#predicate = predicate
    if (array.length > 0) {
      array.forEach(item => {
        this.push(item)
      })
    }
  }
  push (val) {
    this.#items.push(val)
    this.heapUp(this.#items.length - 1)
    return this.#items.length
  }
  pop (val) {
    if (this.#items.length < 3) {
      return this.#items.shift()
    }

    let result = this.#items[0]
    this.#items[0] = this.#items[this.#items.length - 1]
    this.#items.pop()
    this.heapDown(0)
    return result
  }
  peek () {
    return this.#items[0]
  }
  heapUp (idx) {
    let fatherIdx = 0
    while (idx > 0) {
      fatherIdx = (idx - 1) >>> 1
      if (this.#predicate(this.#items[fatherIdx]) < this.#predicate(this.#items[idx])) {
        this.swap(fatherIdx, idx)
      } else {
        break
      }
      idx = fatherIdx
    }
  }
  heapDown (idx) {
    let maxValIdx = idx
    while(true) {
      let leftChildren = idx * 2 + 1
      let rightChildren = leftChildren + 1
      if (leftChildren < this.#items.length && this.#predicate(this.#items[leftChildren]) > this.#predicate(this.#items[maxValIdx])) {
        maxValIdx = leftChildren
      }
      if (rightChildren < this.#items.length && this.#predicate(this.#items[rightChildren]) > this.#predicate(this.#items[maxValIdx])) {
        maxValIdx = rightChildren
      }
      if (maxValIdx != idx) {
        this.swap(maxValIdx, idx)
        idx = maxValIdx
      } else {

        break
      }

    }

  }
  get size () {
    return this.#items.length
  }
  swap(i, j) {
    let temp = 0
    temp = this.#items[i] 
    this.#items[i] = this.#items[j]
    this.#items[j] = temp
  }

}
</script>
<script type="1" id="ch08/0008">
  //堆排序
function heapDown (items, idx, predicate = it => it, length = items.length) {
  let maxValIdx = idx
  // let count = 0
  while(true) {
    // count++
    let leftChildren = idx * 2 + 1
    let rightChildren = leftChildren + 1
    if (leftChildren < length && predicate(items[leftChildren]) > predicate(items[maxValIdx])) {
      maxValIdx = leftChildren
    }
    if (rightChildren < length && predicate(items[rightChildren]) > predicate(items[maxValIdx])) {
      maxValIdx = rightChildren
    }
    if (maxValIdx != idx) {
      swap(items, maxValIdx, idx)
      idx = maxValIdx
    } else {

      break
    }

  }
  // console.log(count)
  // return count

}
function heapify (array, predicate = it => it) {
  // let count = 0
  let times = (array.length - 2) >>> 1
  for (let i = times; i >= 0; i--) {
    // count += heapDown(array, i, predicate)
    heapDown(array, i, predicate)
  }
  // return count
}

function heapSortInPlaceBy (array, predicate = it => it) {
  // let count = 0
  // count = heapify(array, predicate)
  // console.log(count)
  heapify(array, predicate)
  // console.log(array)

  for (let i = array.length - 1; i > 0; i--) {
    swap(array, 0, i)
    heapDown(array, 0, predicate, i)
  }
  return array
}
</script>
<!-- <div id="show123"></div> -->
<script type="1">
  "use strict"
  //用js画表格,实现类似console.table的功能
function consoleTable(array) {
  let heads = [...new Set(array.map(obj => {
    return Object.keys(obj)
  }).flat())]

  let result = "<table border=1>"
    result += "<tr>"
      for (let i = 0; i < heads.length; i++) {
        result += "<td>"
          result += heads[i]
        result += "</td>"
      }
    result += "</tr>"
    array.forEach(obj => {
      result += "<tr>"
      for (let head of heads) {
        if (head in obj) {
          result += "<td>" + obj[head] + "</td>"
        } else {
          result += "<td></td>"
        }
      }
      result += "</tr>"
    })

  result += "</table>"

  return result
}
function showTable(array) {
  let html = consoleTable(array)
  show123.innerHTML = html
}
// showTable([{a:234124, b:777},{a:4444, b:3333}])
</script>
<script type="1">
  //实现 String.raw`sfseion${2+3}skljvnsdv\seku${8+9}vhso\svgkjbw` 的函数
  function raw(a, ...b) {
    let result = ""
    for (let i = 0; i < b.length; i++) {
      result += a.raw[i] + b[i]
    }
    result += a.raw[a.raw.length - 1]
    return result
  }
</script>
<script type="1">
//String.prototype的正则相关函数实现
String.prototype.myserach = function(regexp) {
  let match = regexp.exec(this)
  if (match !== null) {
    return match.index
  } else {
    return -1
  }
}
String.prototype.mysplit = function(regexp) {
  let match = null
  let strArray = []
  let str = ""
  let lastLastIndex = 0
  let regExp = null

  if (regexp.global === false) {
    regExp = new RegExp(regexp.source, regexp.flags + "g")
  }
  while(match = regExp.exec(this)) {
    str = this.slice(lastLastIndex, match.index)
    if (match[0].length !== 0 || str.length !== 0) {
      strArray.push(str)
    }
    for (let i = 1; i < match.length; i++) {
      strArray.push(match[i])
    }
    lastLastIndex = regExp.lastIndex
    if (match[0].length === 0) {
      regExp.lastIndex++
    }
  }
  str = this.slice(lastLastIndex)
  strArray.push(str)
  return strArray
}
String.prototype.mymatch = function(regexp) {
  if (regexp.global === false) {
    return regexp.exec(this)
  }
  let strArray = []
  let match = null
  let regExp = new RegExp(regexp.source, regexp.flags)
  while(match = regExp.exec(this)) {
    strArray.push(match[0])
    if(match[0].length === 0) {
      regExp.lastIndex++
    }
  }
  return strArray
}

// String.prototype.myreplace = function(regexp, predicate) { //predicate 默认等于一个你给它传啥,它直接回传给你的函数
//   let result = ""
//   let regExp = new RegExp(regexp.source, regexp.flags)
//   let match = null
//   let lastLastIndex = 0

//   if(typeof predicate === "function") {
//     if (regExp.global === false) {
//       match = regExp.exec(this)
//       if (match === null) {
//         return this
//       }
//       result += this.slice(lastLastIndex, match.index)
//       result += predicate(...match)
//       lastLastIndex = match.index + match[0].length
//     } else {
//       while(match = regExp.exec(this)) {
//         result += this.slice(lastLastIndex, match.index)
//         result += predicate(...match)
//         lastLastIndex = regExp.lastIndex
//         if (match[0].length === 0) {
//           regExp.lastIndex++
//         }
//       }
//     }
//     result += this.slice(lastLastIndex)

//   } else {

//     if (regExp.global === false) {
//       match = regExp.exec(this)
//       if (match === null) {
//         return this
//       }
//       result += this.slice(lastLastIndex, match.index)
//       result += matchMapReplace(match, predicate)
//       lastLastIndex = match.index + match[0].length
//     } else {
//       while(match = regExp.exec(this)) {
//         result += this.slice(lastLastIndex, match.index)
//         result += matchMapReplace(match, predicate)
//         lastLastIndex = regExp.lastIndex
//         if (match[0].length === 0) {
//           regExp.lastIndex++
//         }
//       }
//     }
//     result += this.slice(lastLastIndex)
//   }

//   return result
// }

String.prototype.myreplace = function(regexp, predicate) { //predicate 默认等于一个你给它传啥,它直接回传给你的函数
  let result = null
  if(typeof predicate === "function") {
    result = implementReplace(this, regexp, predicate)
    
  } else {
    result = implementReplace(this, regexp, matchMapReplace(predicate))

  }
  return result
}
function implementReplace(string, regexp, func) {
  let result = ""
  let regExp = new RegExp(regexp.source, regexp.flags)
  let match = null
  let lastLastIndex = 0

  if (regExp.global === false) {
    match = regExp.exec(string)
    if (match === null) {
      return string
    }
    result += string.slice(lastLastIndex, match.index)
    result += func(...match)
    lastLastIndex = match.index + match[0].length
  } else {
    while(match = regExp.exec(string)) {
      result += string.slice(lastLastIndex, match.index)
      result += func(...match)
      lastLastIndex = regExp.lastIndex
      if (match[0].length === 0) {
        regExp.lastIndex++
      }
    }
  }
  result += string.slice(lastLastIndex)
  return result
}
function matchMapReplace(predicate) {
  return function(...matchData) {
    let matchMap = {}
    let regExp = /\$[123456789&]/g
    let result = ""
    let match = null
    let lastLastIndex = 0
    let str = ""
    matchMap["$&"] = matchData[0]
    for(let i = 1; i < matchData.length; i++) {
      matchMap[`$${i}`] = matchData[i]
    }
    while(match = regExp.exec(predicate)) {
      result += predicate.slice(lastLastIndex, match.index)
      if (matchMap[match[0]] === undefined) {
        result += match[0]
      } else {
        result += matchMap[match[0]]
      }
      lastLastIndex = regExp.lastIndex
    }
    result += predicate.slice(lastLastIndex)
    return result
  }
}
</script>
